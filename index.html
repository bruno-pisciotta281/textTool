<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <title>Teste de Digitação</title>
    <link rel="stylesheet" href="styles.css">
</head>

<style>
    body {

        font-family: "Montserrat", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;

        background-color: #f4f4f4;
        margin: 0px;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 400px;
    }

    h1 {
        margin-bottom: 20px;
        font-size: 24px;
    }

    #inputOriginalText {
        width: 100%;
        height: 50px;
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
    }

    #highlightedText {
        margin-bottom: 20px;
        font-size: 18px;
        color: #555;
        white-space: pre-wrap;
        text-align: left;
        overflow-y: auto; /* Adiciona rolagem se o texto for muito grande */
        max-height: 150px; /* Limita a altura para melhor visualização */
        position: relative;
    }

    textarea {
        width: 95% !important;
        height: 100px;
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
        color: black;
        background-color: #f9f9f9;
    }

    .correct {
        color: green;
    }

    .incorrect {
        color: red;
    }

    .copied-message {
        color: red;
        margin-top: 10px;
        font-weight: bold;
        display: none;
    }

    .buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }

    button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    button:disabled {
        background-color: #ccc;
    }

    #result {
        margin-top: 20px;
        font-size: 18px;
    }

    #result p {
        margin: 5px 0;
    }

    .copied-message {
        display: none;
        color: red;
        font-weight: bold;
        margin-top: 10px;
        opacity: 1;
        transition: opacity 1s ease-out;
    }
</style>

<body>
    <div class="container">
        <h1>Teste de Digitação</h1>
        <textarea id="inputOriginalText" placeholder="Insira o texto para o teste aqui..."></textarea>
        <div class="buttons">
            <button id="suggestButton">Sugerir Texto</button>
            <button id="clearButton">Limpar</button>
        </div>
        <hr>
        <div id="highlightedText"></div>
        <hr>
        <textarea id="inputText" placeholder="Digite o texto aqui..." disabled></textarea>
        <div id="copiedMessage" class="copied-message">Texto copiado</div>
        <div class="buttons">
            <button id="startButton">Iniciar Teste</button>
            <button id="stopButton" disabled>Parar Teste</button>
            <button id="resetButton">Reiniciar Teste</button>
        </div>
        <hr>
        <div id="result">
            <p>Erros: <span id="errors">0</span></p>
            <p>Tempo: <span id="time">0.00</span> segundos</p>
            <p>Velocidade: <span id="speed">0</span> WPM</p>
            <strong><p>Pontuação: <span id="score">0</span></p></strong>
        </div>
    </div>
    <script>
        let originalText = '';
        const inputOriginalText = document.getElementById('inputOriginalText');
        const highlightedText = document.getElementById('highlightedText');
        const inputText = document.getElementById('inputText');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const resetButton = document.getElementById('resetButton');
        const suggestButton = document.getElementById('suggestButton');
        const clearButton = document.getElementById('clearButton');
        const errorsElement = document.getElementById('errors');
        const timeElement = document.getElementById('time');
        const speedElement = document.getElementById('speed');
        const scoreElement = document.getElementById('score');
        const copiedMessage = document.getElementById('copiedMessage');
    
        let startTime, timerInterval, backspaceCount = 0;
        let timerStarted = false;
    
        const suggestedTexts = [
            "A vida é como andar de bicicleta. Para manter o equilíbrio, é preciso continuar se movendo.",
            "O sucesso é a soma de pequenos esforços repetidos dia após dia.",
            "A persistência é o caminho do êxito.",
            "Nada é tão contagioso quanto o entusiasmo.",
            "O único lugar onde o sucesso vem antes do trabalho é no dicionário.",
            "A paciência é a arte de esperar sem perder a esperança.",
            "O verdadeiro líder inspira outros a encontrar sua própria grandeza.",
            "A gratidão transforma o que temos em suficiente.",
            "A sabedoria não está em ter todas as respostas, mas em fazer as perguntas certas.",
            "A coragem não é a ausência do medo, mas a decisão de que algo é mais importante que o medo.",
            "O otimismo é o íman da felicidade.",
            "A humildade é a base do crescimento pessoal.",
            "A compaixão é a linguagem universal do coração.",
            "A autenticidade é o melhor perfume que se pode usar.",
            "A flexibilidade mental é o segredo para se adaptar a um mundo em constante mudança.",
            "O autoconhecimento é o primeiro passo para a realização pessoal.",
            "A disciplina é a ponte entre metas e realizações.",
            "A empatia é o alicerce de relacionamentos significativos.",
            "A resiliência transforma obstáculos em oportunidades.",
            "O conhecimento é a chave que abre todas as portas da oportunidade.",
            "A gentileza é uma linguagem que todos podem entender.",
            "Cada desafio é uma chance de crescer e se fortalecer.",
            "A criatividade floresce quando regada com curiosidade.",
            "O respeito mútuo é a base de relacionamentos duradouros."
        ];
    
        suggestButton.addEventListener('click', suggestText);
        clearButton.addEventListener('click', clearText);
        startButton.addEventListener('click', startTest);
        stopButton.addEventListener('click', stopTest);
        resetButton.addEventListener('click', resetTest);
        inputText.addEventListener('keydown', countBackspace);
        inputText.addEventListener('input', startTimerOnInput);
        inputText.addEventListener('input', updateHighlightedText);
        inputText.addEventListener('paste', detectPaste);
    
        function suggestText() {
            const randomIndex = Math.floor(Math.random() * suggestedTexts.length);
            inputOriginalText.value = suggestedTexts[randomIndex];
            inputOriginalText.dispatchEvent(new Event('input'));
        }
    
        function clearText() {
            inputOriginalText.value = '';
            inputText.value = '';
            highlightedText.innerHTML = '';
            errorsElement.innerText = '0';
            backspaceCount = 0;
            scoreElement.innerText = '0';
            copiedMessage.style.display = 'none';
        }
    
        function startTest() {
            originalText = inputOriginalText.value.trim();
            if (!originalText) {
                alert('Por favor, insira o texto para o teste.');
                return;
            }

            startTime = new Date().getTime();
            console.log("Tempo de início:", startTime); // Adicione este log
            inputText.value = '';
            inputText.disabled = false;
            inputText.focus();
            startButton.disabled = true;
            stopButton.disabled = false;
            resetButton.disabled = true;
            errorsElement.innerText = '0';
            timeElement.innerText = '0.00';
            speedElement.innerText = '0';
            backspaceCount = 0;

            updateHighlightedText(); // Atualiza a visualização inicial do texto
            highlightedText.style.display = 'block';
        }

    
        function startTimerOnInput() {
            if (!timerStarted) {
                timerStarted = true;
                console.log("Iniciando o temporizador..."); // Adicione este log
                timerInterval = setInterval(() => {
                    const currentTime = new Date().getTime();
                    const timeElapsed = (currentTime - startTime) / 1000;
                    timeElement.innerText = timeElapsed.toFixed(2);
                }, 100);
            }
        }
    
        function stopTest() {
            clearInterval(timerInterval);
            inputText.disabled = true;
            startButton.disabled = false;
            stopButton.disabled = true;
            resetButton.disabled = false;
            calculateSpeed();
            calculateScore();
        }
    
        function resetTest() {
            clearText();
            clearInterval(timerInterval); // Limpa o intervalo do temporizador
            startButton.disabled = false;
            stopButton.disabled = true;
            resetButton.disabled = true;
            inputOriginalText.focus();
            timerStarted = false;
            startTime = null; // Zera o tempo inicial
            timeElement.innerText = '0.00'; // Reseta o tempo exibido para 0.00 segundos
            speedElement.innerText = '0'; // Reseta a velocidade exibida para 0 WPM
            scoreElement.innerText = '0'; // Reseta a pontuação exibida para 0
            backspaceCount = 0; // Zera a contagem de erros
            errorsElement.innerText = '0'; // Reseta a exibição de erros para 0
        }
    
        function updateHighlightedText() {
            const typedText = inputText.value;
            const visibleTextStart = Math.max(0, typedText.length - 100); // Ajuste conforme necessário
            const visibleTextEnd = Math.min(originalText.length, typedText.length + 100);
            
            const visibleOriginalText = originalText.slice(visibleTextStart, visibleTextEnd);
            const typedTextSegment = typedText.slice(visibleTextStart, visibleTextEnd);
            
            let highlighted = '';
            for (let i = 0; i < visibleOriginalText.length; i++) {
                if (i < typedTextSegment.length) {
                    if (typedTextSegment[i] === visibleOriginalText[i]) {
                        highlighted += `<span class="correct">${visibleOriginalText[i]}</span>`;
                    } else {
                        highlighted += `<span class="incorrect">${visibleOriginalText[i]}</span>`;
                    }
                } else {
                    highlighted += `<span class="default">${visibleOriginalText[i]}</span>`;
                }
            }
            
            highlightedText.innerHTML = highlighted;
            
            // Rolar o texto para acompanhar a digitação
            const container = highlightedText.parentElement;
            container.scrollTop = highlightedText.scrollHeight;

            checkText(); // Verificar se o texto digitado está completo
        }
        function checkText() {
        const input = inputText.value;
        if (input === originalText) {
            stopTest(); // Encerrar o teste se o texto digitado corresponder ao texto original
        }
    }
    
        function countBackspace(event) {
            if (event.key === 'Backspace') {
                backspaceCount++;
                errorsElement.innerText = backspaceCount;
            }
        }
    
        function calculateSpeed() {
            const timeElapsed = (new Date().getTime() - startTime) / 60000; // in minutes
            const wordCount = inputText.value.trim().split(/\s+/).length;
            const wpm = Math.floor(wordCount / timeElapsed);
            speedElement.innerText = wpm;
        }
    
        function calculateScore() {
            const totalWords = originalText.split(' ').length;
            const typedWords = inputText.value.split(' ').length;
            const timeElapsed = (new Date().getTime() - startTime) / 1000; // em segundos
            const maxTime = 300; // Tempo máximo em segundos para pontuação total (por exemplo, 5 minutos)
    
            // Normalização dos fatores
            const accuracy = Math.max(0, 1 - (backspaceCount / totalWords));
            const wordFactor = Math.min(1, typedWords / totalWords);
            const timeFactor = Math.max(0, 1 - (timeElapsed / maxTime));
    
            // Cálculo da pontuação (entre 1 e 10)
            const score = Math.round(10 * (0.5 * wordFactor + 0.3 * accuracy + 0.2 * timeFactor));
            scoreElement.innerText = score;
        }
        
        function detectPaste(event) {
            const pastedText = event.clipboardData.getData('text');
            if (pastedText === originalText) {
                copiedMessage.style.display = 'block';
                copiedMessage.style.opacity = '1'; // Garantir que a mensagem comece opaca
                event.preventDefault();
                inputText.value = '';
                
                // Remover a mensagem após 3 segundos com efeito fade-out
                setTimeout(() => {
                    copiedMessage.style.opacity = '0'; // Inicia o fade-out
                    setTimeout(() => {
                        copiedMessage.style.display = 'none'; // Esconde completamente após o fade-out
                    }, 1000); // Tempo do fade-out (1 segundo neste caso)
                }, 3000); // Aguardar 3 segundos antes de iniciar o fade-out
            } else {
                copiedMessage.style.display = 'none';
            }
        }
    </script>
    
</body>
</html>
